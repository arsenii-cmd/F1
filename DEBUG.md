# Инструкция по отладке

## ⚠️ ИСПРАВЛЕНО: Проблема с кодировкой
Файл `script.js` был сохранен в неправильной кодировке, что приводило к ошибкам при загрузке.
Проблема исправлена - файл пересохранен в UTF-8.

## Шаг 0: Быстрая проверка
1. Откройте `test-simple.html` в браузере
2. Если видите ✅ "Все функции загружены успешно" - переходите к index.html
3. Если видите ❌ ошибки - сообщите о них

## Шаг 1: Откройте test.html
1. Откройте файл `test.html` в браузере
2. Откройте консоль (F12)
3. Проверьте, загружаются ли данные из Jolpica API

**Если test.html работает** → проблема в основном коде
**Если test.html не работает** → проблема с сетью/API

## Шаг 2: Откройте index.html
1. Откройте `index.html` в браузере
2. Откройте консоль (F12)
3. Проверьте ошибки

### Типичные ошибки:

**1. "dataCache is not defined"**
- Решение: Обновите страницу с очисткой кэша (Ctrl+Shift+R)

**2. "CACHE_LIFETIME is not defined"**
- Решение: Обновите страницу с очисткой кэша (Ctrl+Shift+R)

**3. "Failed to fetch"**
- Проблема с сетью или CORS
- Проверьте, работает ли https://api.jolpi.ca/ergast/f1/2025.json

**4. Service Worker ошибки**
- Откройте DevTools → Application → Service Workers
- Нажмите "Unregister" для всех воркеров
- Обновите страницу

## Шаг 3: Очистка кэша

### Вариант 1: Через консоль
```javascript
clearAllCaches()
```

### Вариант 2: Вручную
1. F12 → Application → Storage
2. Clear site data
3. Обновите страницу

### Вариант 3: Жёсткое обновление
- Windows: Ctrl + Shift + R
- Mac: Cmd + Shift + R

## Шаг 4: Проверка версии Service Worker

В консоли выполните:
```javascript
navigator.serviceWorker.getRegistrations().then(regs => {
    regs.forEach(reg => console.log('SW:', reg.active?.scriptURL));
});
```

Должно быть: `f1-2026-v6`

## Шаг 5: Проверка состояния кэша

В консоли выполните:
```javascript
debugCache()
```

Должно показать состояние всех кэшей.

## Шаг 6: Ручная загрузка данных

В консоли выполните:
```javascript
// Очистить кэш
dataCache.races = null;
dataCache.drivers = null;
dataCache.constructors = null;

// Загрузить заново
refreshData();
```

## Частые проблемы и решения

### Проблема: Пустая страница
**Причина:** JavaScript не загрузился или есть синтаксическая ошибка
**Решение:**
1. Проверьте консоль на ошибки
2. Убедитесь, что `script.js` загружается (Network tab)

### Проблема: "Загрузка..." бесконечно
**Причина:** Запрос к API завис или упал
**Решение:**
1. Проверьте Network tab - есть ли запросы к api.jolpi.ca
2. Проверьте, не заблокирован ли API файрволом/антивирусом

### Проблема: Старые данные
**Причина:** Кэш не очистился
**Решение:**
```javascript
clearAllCaches()
```

### Проблема: Модальное окно не открывается
**Причина:** Ошибка в loadResultsIntoTable
**Решение:**
1. Проверьте консоль на ошибки
2. Проверьте, что гонка имеет результаты в API

## Контакты для отладки

Если ничего не помогло, предоставьте:
1. Скриншот консоли (F12)
2. Скриншот Network tab
3. Версию браузера
4. Работает ли test.html
